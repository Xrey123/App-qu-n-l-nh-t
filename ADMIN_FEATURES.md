# ğŸ” TÃ­nh nÄƒng Admin - Quáº£n lÃ½ toÃ n diá»‡n dá»¯ liá»‡u

## ğŸ“‹ Tá»•ng quan

User **admin** giá» Ä‘Ã¢y cÃ³ **Ä‘áº§y Ä‘á»§ quyá»n** chá»‰nh sá»­a vÃ  xÃ³a dá»¯ liá»‡u khi cÃ³ sai sÃ³t. CÃ¡c tÃ­nh nÄƒng nÃ y **chá»‰ hiá»ƒn thá»‹ vá»›i admin**, cÃ²n accountant/staff chá»‰ xem Ä‘Æ°á»£c.

---

## âœ¨ CÃ¡c tÃ­nh nÄƒng má»›i

### 1ï¸âƒ£ **Tab "HÃ³a Ä‘Æ¡n"**

Admin cÃ³ thá»ƒ:

#### ğŸ“ **Sá»­a chi tiáº¿t hÃ³a Ä‘Æ¡n**
- **NÃºt**: âœï¸ Sá»­a chi tiáº¿t
- **Chá»©c nÄƒng**: Sá»­a sá»‘ lÆ°á»£ng, ghi chÃº cá»§a tá»«ng sáº£n pháº©m trong hÃ³a Ä‘Æ¡n
- **CÃ¡ch dÃ¹ng**: 
  1. Click vÃ o dÃ²ng chi tiáº¿t cáº§n sá»­a
  2. Click nÃºt "âœï¸ Sá»­a chi tiáº¿t"
  3. Nháº­p sá»‘ lÆ°á»£ng má»›i hoáº·c ghi chÃº
  4. OK Ä‘á»ƒ lÆ°u

#### ğŸ—‘ï¸ **XÃ³a chi tiáº¿t hÃ³a Ä‘Æ¡n**
- **NÃºt**: ğŸ—‘ï¸ XÃ³a chi tiáº¿t
- **Chá»©c nÄƒng**: XÃ³a má»™t sáº£n pháº©m khá»i hÃ³a Ä‘Æ¡n
- **Cáº£nh bÃ¡o**: CÃ³ xÃ¡c nháº­n trÆ°á»›c khi xÃ³a
- **CÃ¡ch dÃ¹ng**:
  1. Click vÃ o dÃ²ng chi tiáº¿t cáº§n xÃ³a
  2. Click nÃºt "ğŸ—‘ï¸ XÃ³a chi tiáº¿t"
  3. XÃ¡c nháº­n "CÃ³" Ä‘á»ƒ xÃ³a

#### ğŸ“ **Sá»­a thÃ´ng tin hÃ³a Ä‘Æ¡n**
- **NÃºt**: ğŸ“ Sá»­a hÃ³a Ä‘Æ¡n
- **Chá»©c nÄƒng**: Sá»­a ngÃ y giá», ghi chÃº cá»§a hÃ³a Ä‘Æ¡n
- **á»¨ng dá»¥ng**: Sá»­a lá»—i nháº­p sai thá»i gian
- **CÃ¡ch dÃ¹ng**:
  1. Click vÃ o hÃ³a Ä‘Æ¡n cáº§n sá»­a
  2. Click nÃºt "ğŸ“ Sá»­a hÃ³a Ä‘Æ¡n"
  3. Chá»‰nh sá»­a ngÃ y/giá» hoáº·c ghi chÃº
  4. OK Ä‘á»ƒ lÆ°u

#### âŒ **XÃ³a hÃ³a Ä‘Æ¡n**
- **NÃºt**: âŒ XÃ³a hÃ³a Ä‘Æ¡n
- **Chá»©c nÄƒng**: XÃ³a toÃ n bá»™ hÃ³a Ä‘Æ¡n vÃ  táº¥t cáº£ chi tiáº¿t
- **Cáº£nh bÃ¡o**: âš ï¸ KhÃ´ng thá»ƒ hoÃ n tÃ¡c! CÃ³ xÃ¡c nháº­n trÆ°á»›c khi xÃ³a
- **CÃ¡ch dÃ¹ng**:
  1. Click vÃ o hÃ³a Ä‘Æ¡n cáº§n xÃ³a
  2. Click nÃºt "âŒ XÃ³a hÃ³a Ä‘Æ¡n"
  3. Äá»c cáº£nh bÃ¡o ká»¹
  4. XÃ¡c nháº­n "CÃ³" Ä‘á»ƒ xÃ³a vÄ©nh viá»…n

---

### 2ï¸âƒ£ **Tab "Chi tiáº¿t bÃ¡n"**

Admin cÃ³ thá»ƒ:

#### ğŸ“ **Sá»­a hÃ³a Ä‘Æ¡n chÆ°a xuáº¥t**
- **NÃºt**: âœï¸ Sá»­a hÃ³a Ä‘Æ¡n
- **Chá»©c nÄƒng**: Giá»‘ng tab "HÃ³a Ä‘Æ¡n", nhÆ°ng dÃ nh cho hÃ³a Ä‘Æ¡n chÆ°a xuáº¥t
- **á»¨ng dá»¥ng**: Sá»­a thá»i gian ghi nháº­n trÆ°á»›c khi xuáº¥t hÃ³a Ä‘Æ¡n

#### ğŸ—‘ï¸ **XÃ³a hÃ³a Ä‘Æ¡n chÆ°a xuáº¥t**
- **NÃºt**: ğŸ—‘ï¸ XÃ³a hÃ³a Ä‘Æ¡n
- **Chá»©c nÄƒng**: XÃ³a hÃ³a Ä‘Æ¡n lá»—i trÆ°á»›c khi xuáº¥t
- **Cáº£nh bÃ¡o**: âš ï¸ KhÃ´ng thá»ƒ hoÃ n tÃ¡c!

---

## ğŸ”§ Backend Functions

### File: `invoices.py`

```python
# Sá»­a hÃ³a Ä‘Æ¡n
sua_hoa_don(hoadon_id, ngay=None, khach_hang=None, ghi_chu=None)

# XÃ³a hÃ³a Ä‘Æ¡n (xÃ³a cáº£ chi tiáº¿t)
xoa_hoa_don(hoadon_id)

# Sá»­a chi tiáº¿t hÃ³a Ä‘Æ¡n
sua_chi_tiet_hoa_don(chitiet_id, so_luong=None, gia=None, giam=None, ghi_chu=None)

# XÃ³a chi tiáº¿t hÃ³a Ä‘Æ¡n
xoa_chi_tiet_hoa_don(chitiet_id)
```

**Äáº·c Ä‘iá»ƒm**:
- Táº¥t cáº£ tham sá»‘ Ä‘á»u **optional** (None = khÃ´ng Ä‘á»•i)
- Sá»­ dá»¥ng **db_transaction** Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n dá»¯ liá»‡u
- CÃ³ logging lá»—i chi tiáº¿t

---

## ğŸ›¡ï¸ PhÃ¢n quyá»n

| Vai trÃ² | Xem dá»¯ liá»‡u | Sá»­a dá»¯ liá»‡u | XÃ³a dá»¯ liá»‡u |
|---------|-------------|-------------|-------------|
| **Admin** | âœ… | âœ… | âœ… |
| **Accountant** | âœ… | âŒ | âŒ |
| **Staff** | âœ… (chá»‰ cá»§a mÃ¬nh) | âŒ | âŒ |

---

## âš ï¸ LÆ°u Ã½ quan trá»ng

### 1. **XÃ³a dá»¯ liá»‡u khÃ´ng thá»ƒ hoÃ n tÃ¡c**
- LuÃ´n cÃ³ dialog xÃ¡c nháº­n trÆ°á»›c khi xÃ³a
- Äá»c ká»¹ cáº£nh bÃ¡o trÆ°á»›c khi click "CÃ³"

### 2. **Tá»“n kho khÃ´ng tá»± Ä‘á»™ng hoÃ n tráº£**
- Khi xÃ³a hÃ³a Ä‘Æ¡n, há»‡ thá»‘ng **KHÃ”NG** tá»± Ä‘á»™ng cá»™ng láº¡i tá»“n kho
- Admin cáº§n kiá»ƒm tra vÃ  Ä‘iá»u chá»‰nh thá»§ cÃ´ng náº¿u cáº§n

### 3. **Sá»­a thá»i gian**
- Sá»­a thá»i gian hÃ³a Ä‘Æ¡n **khÃ´ng áº£nh hÆ°á»Ÿng** Ä‘áº¿n tá»“n kho
- Chá»‰ áº£nh hÆ°á»Ÿng Ä‘áº¿n bÃ¡o cÃ¡o theo ngÃ y

### 4. **Cá»™t ID trong tab "HÃ³a Ä‘Æ¡n"**
- Admin sáº½ tháº¥y thÃªm 2 cá»™t: **ID HÄ** vÃ  **ID CT**
- Accountant/Staff khÃ´ng tháº¥y cÃ¡c cá»™t nÃ y
- DÃ¹ng Ä‘á»ƒ admin biáº¿t Ä‘ang sá»­a/xÃ³a Ä‘Ãºng record

---

## ğŸ“Š UI Changes

### Tab "HÃ³a Ä‘Æ¡n"
```
TrÆ°á»›c (táº¥t cáº£ role):
[NgÃ y] [Username] [TÃªn SP] [SL] [Loáº¡i giÃ¡] [Tá»•ng tiá»n]

Sau (admin):
[ID HÄ] [ID CT] [NgÃ y] [Username] [TÃªn SP] [SL] [Loáº¡i giÃ¡] [Tá»•ng tiá»n]
+ NÃºt: [âœï¸ Sá»­a chi tiáº¿t] [ğŸ—‘ï¸ XÃ³a chi tiáº¿t] [ğŸ“ Sá»­a hÃ³a Ä‘Æ¡n] [âŒ XÃ³a hÃ³a Ä‘Æ¡n]
```

### Tab "Chi tiáº¿t bÃ¡n"
```
TrÆ°á»›c:
[LÃ m má»›i]

Sau (admin):
[LÃ m má»›i] [âœï¸ Sá»­a hÃ³a Ä‘Æ¡n] [ğŸ—‘ï¸ XÃ³a hÃ³a Ä‘Æ¡n]
```

---

## ğŸ§ª Testing

### Test Case 1: Sá»­a thá»i gian hÃ³a Ä‘Æ¡n
1. ÄÄƒng nháº­p vá»›i **admin**
2. VÃ o tab "HÃ³a Ä‘Æ¡n"
3. Click vÃ o má»™t hÃ³a Ä‘Æ¡n
4. Click "ğŸ“ Sá»­a hÃ³a Ä‘Æ¡n"
5. Thay Ä‘á»•i ngÃ y/giá»
6. Kiá»ƒm tra DB: `SELECT ngay FROM HoaDon WHERE id = ?`

### Test Case 2: XÃ³a chi tiáº¿t hÃ³a Ä‘Æ¡n
1. ÄÄƒng nháº­p vá»›i **admin**
2. VÃ o tab "HÃ³a Ä‘Æ¡n"
3. Click vÃ o má»™t chi tiáº¿t
4. Click "ğŸ—‘ï¸ XÃ³a chi tiáº¿t"
5. XÃ¡c nháº­n
6. Kiá»ƒm tra DB: record Ä‘Ã£ bá»‹ xÃ³a

### Test Case 3: PhÃ¢n quyá»n
1. ÄÄƒng nháº­p vá»›i **accountant** â†’ KhÃ´ng tháº¥y nÃºt sá»­a/xÃ³a
2. ÄÄƒng nháº­p vá»›i **staff** â†’ KhÃ´ng tháº¥y nÃºt sá»­a/xÃ³a
3. ÄÄƒng nháº­p vá»›i **admin** â†’ Tháº¥y Ä‘áº§y Ä‘á»§ nÃºt

---

## ğŸ¯ Use Cases

### Case 1: Nháº­p sai thá»i gian
**TÃ¬nh huá»‘ng**: Staff nháº­p hÃ³a Ä‘Æ¡n lÃºc 14:00 nhÆ°ng quÃªn, bÃ¢y giá» lÃ  18:00  
**Giáº£i phÃ¡p**: Admin sá»­a thá»i gian hÃ³a Ä‘Æ¡n vá» 14:00

### Case 2: Nháº­p sai sá»‘ lÆ°á»£ng
**TÃ¬nh huá»‘ng**: Nháº­p 100 thay vÃ¬ 10  
**Giáº£i phÃ¡p**: Admin sá»­a chi tiáº¿t hÃ³a Ä‘Æ¡n, Ä‘á»•i sá»‘ lÆ°á»£ng vá» 10

### Case 3: HÃ³a Ä‘Æ¡n bá»‹ duplicate
**TÃ¬nh huá»‘ng**: Click lÆ°u 2 láº§n, táº¡o 2 hÃ³a Ä‘Æ¡n giá»‘ng nhau  
**Giáº£i phÃ¡p**: Admin xÃ³a hÃ³a Ä‘Æ¡n duplicate

### Case 4: KhÃ¡ch hÃ ng tráº£ hÃ ng
**TÃ¬nh huá»‘ng**: KhÃ¡ch tráº£ láº¡i 1 sáº£n pháº©m trong hÃ³a Ä‘Æ¡n  
**Giáº£i phÃ¡p**: Admin xÃ³a chi tiáº¿t sáº£n pháº©m Ä‘Ã³

---

## ğŸ”® Future Enhancements

1. **Log lá»‹ch sá»­ sá»­a/xÃ³a**: Ghi láº¡i ai sá»­a, xÃ³a gÃ¬, khi nÃ o
2. **HoÃ n tráº£ tá»“n kho tá»± Ä‘á»™ng**: Khi xÃ³a hÃ³a Ä‘Æ¡n â†’ cá»™ng láº¡i tá»“n kho
3. **Soft delete**: ÄÃ¡nh dáº¥u xÃ³a thay vÃ¬ xÃ³a vÄ©nh viá»…n
4. **Undo/Redo**: HoÃ n tÃ¡c thao tÃ¡c vá»«a rá»“i

---

## ğŸ“ Summary

âœ… Admin cÃ³ **toÃ n quyá»n** sá»­a/xÃ³a dá»¯ liá»‡u  
âœ… CÃ³ **xÃ¡c nháº­n** trÆ°á»›c khi xÃ³a  
âœ… Chá»‰ admin má»›i tháº¥y cÃ¡c nÃºt nÃ y  
âœ… Backend **an toÃ n** vá»›i db_transaction  
âœ… UI **rÃµ rÃ ng** vá»›i icon vÃ  label  

**ğŸ‰ Giá» Ä‘Ã¢y admin cÃ³ thá»ƒ tá»± tin sá»­a má»i sai sÃ³t!**
